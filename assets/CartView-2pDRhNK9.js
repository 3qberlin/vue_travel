import{_ as V,m as w,a as C,L as $,r as b,o as n,c as a,d as f,b as t,g,F as x,j as E,e as y,w as k,k as S,v as B,t as c,f as N}from"./index-Z4xjsCl-.js";import{S as m,c as v}from"./cartPinia-xYsTm3E4.js";import{a as l}from"./axios-G2rPRu76.js";import{T as A,t as T}from"./TravelConditions-JJH02K_q.js";var R={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_NAME:"berlin",BASE_URL:"/vue_week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:p,VITE_API_NAME:_}=R,U={computed:{...w(v,["final_total","total","carts"]),...w(T,["selectedPeople","startTime","endTime"])},methods:{...C(v,["getCarts","pinia_carts"]),...C(T,["setPeople"]),addProduct(o){const e={product_id:o.product_id,qty:o.qty+1};this.showLoading(),setTimeout(()=>{const d=`${p}/api/${_}/cart/${o.id}`;l.put(d,{data:e}).then(()=>{this.carts.qty=e.qty,this.getCarts()})},500)},showLoading(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},900)},reduceProduct(o){if(o.qty===1)m.fire({title:"最低數量為1筆",showClass:{popup:`
      animate__animated
      animate__fadeInUp
      animate__faster
    `},hideClass:{popup:`
      animate__animated
      animate__fadeOutDown
      animate__faster
    `}});else{const d={product_id:o.product_id,qty:o.qty-1};this.showLoading();const h=`${p}/api/${_}/cart/${o.id}`;l.put(h,{data:d}).then(()=>{this.carts.qty=d.qty,this.getCarts()})}},delCartItem(o){this.showLoading();const e=`${p}/api/${_}/cart/${o}`;l.delete(e).then(()=>{this.getCarts()}).catch(()=>{})},couponTicket(){const o={code:this.couponContent},e=`${p}/api/${_}/coupon`;this.showLoading(),l.post(e,{data:o}).then(d=>{this.final_total=d.data.data.final_total,this.noneCoupon="已套用優惠券",this.couponStatus=!0,this.getCarts()}).catch(d=>{this.noneCoupon=d.response.data.message,this.final_total=this.total,this.couponStatus=!1,this.getCarts()})},delCarts(){const o=`${p}/api/${_}/carts`;m.fire({title:"刪除確認",text:"確定刪除全部商品？",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確認刪除",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&l.delete(o).then(()=>{this.getCarts(),m.fire({title:"購物車已清空",text:"商品清空",icon:"success"})}).catch(()=>{})})},updateQty(o,e){const d=parseInt(o.target.value,10),h=`${p}/api/${_}/cart/${e.id}`,i={product_id:e.product_id,qty:d};d>=1&&d<=20?l.put(h,{data:i}).then(()=>{this.carts.qty=i.qty,this.getCarts()}):m.fire("請輸入1以上，20以內的數量")}},mounted(){this.getCarts(),this.showLoading()},data(){return{couponContent:"",noneCoupon:"",countTotal:0,couponStatus:!1,isLoading:!1,fullPage:!0,qty:0}},components:{Loading:$,TravelConditions:A}},D={class:"container"},M={class:"mt-3"},j=t("h3",{class:"mt-3 mb-4"},"購物車",-1),O={class:"row"},F={class:"col-md-8 table-responsive"},Q={class:"table table-hover"},z={key:0},G={class:"text-nowrap"},H=t("th",{scope:"col",class:"border-0 ps-0"},"品項",-1),J=t("th",{scope:"col",class:"border-0"},"數量",-1),K=t("th",{scope:"col",class:"border-0"},"單價",-1),W=t("th",{scope:"col",class:"border-0"},"刪除",-1),X={scope:"col",class:"border-0 text-danger"},Y={key:1},Z={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},tt=["src"],ot={class:"mb-0 fw-bold ms-3 d-inline-block"},et={class:"border-0 align-middle",style:{"max-width":"160px"}},st={class:"input-group pe-5"},nt={class:"input-group-prepend"},at=["onClick"],dt=t("i",{class:"bi bi-dash"},null,-1),it=[dt],ct=["value","id","qty","onChange"],rt={class:"input-group-append"},lt=["onClick"],pt=t("i",{class:"bi bi-plus-lg"},null,-1),_t=[pt],ht={class:"border-0 align-middle"},ut={class:"mb-0 ms-auto"},bt={class:"border-0 align-middle text-center"},mt=["onClick"],ft=t("td",null,null,-1),gt={key:2},yt={class:"fs-5 text-center"},wt={key:0,class:"input-group w-50 mb-3"},Ct={class:"input-group-append"},xt={class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2"},kt={key:0},vt={class:"col-md-4"},Tt={class:"border p-4 mb-4"},Lt=t("h4",{class:"fw-bold mb-4"},"訂單資料",-1),qt={class:"table text-muted border-bottom"},Pt=t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal d-flex flex-grow-1"}," 旅遊期間 ",-1),It={key:0,class:"text-end border-0 px-0 pt-4"},Vt={key:1,class:"text-end border-0 px-0 pt-3 d-flex flex-wrap w-100"},$t={class:"w-100"},Et={class:"w-100"},St=t("th",{scope:"row",class:"border-0 px-0 pt-3 font-weight-normal"}," 人數 ",-1),Bt={key:0,class:"text-end border-0 px-0 pt-4"},Nt={key:1,class:"text-end border-0 px-0 pt-3"},At=t("th",{scope:"row",class:"border-0 px-0 font-weight-normal"}," 小計 ",-1),Rt={class:"text-end border-0 px-0"},Ut=t("tr",null,[t("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 pt-2 font-weight-normal"}," 付款方式 "),t("td",{class:"text-end border-0 px-0 pt-0 pb-4 pt-2"},"LinePay")],-1),Dt={class:"d-flex justify-content-between mt-4"},Mt=t("p",{class:"mb-0 h4 fw-bold"},"總計",-1),jt={key:0,class:"mb-0 h4 fw-bold"},Ot={key:1,class:"mb-0 h4 fw-bold"},Ft={key:0,class:"btn btn-dark w-100 mt-4",disabled:"",tabindex:"-1"},Qt=t("button",{class:"btn btn-dark w-100 mt-4"},"送出訂單 ",-1);function zt(o,e,d,h,i,r){const L=b("TravelConditions"),q=b("router-link"),P=b("RouterLink"),I=b("loading");return n(),a(x,null,[f(L),t("div",D,[t("div",M,[j,t("div",O,[t("div",F,[t("table",Q,[this.carts.length>=1?(n(),a("thead",z,[t("tr",G,[H,J,K,W,t("th",X,[t("div",{class:"badge bg-danger fw-normal",onClick:e[0]||(e[0]=(...s)=>r.delCarts&&r.delCarts(...s)),style:{cursor:"pointer"}}," 全刪 ")])])])):g("",!0),this.carts.length>=1?(n(),a("tbody",Y,[(n(!0),a(x,null,E(o.carts,s=>(n(),a("tr",{class:"border-bottom border-top",key:s},[t("th",Z,[t("img",{src:s.product.imagesUrl,alt:"images",style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,tt),t("p",ot,c(s.product.title),1)]),t("td",et,[t("div",st,[t("div",nt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon1",onClick:u=>r.reduceProduct(s)},it,8,at)]),t("input",{type:"text",class:"form-control border-0 text-center my-auto shadow-none",placeholder:"","aria-label":"Example text with button addon","aria-describedby":"button-addon1",value:s.qty,id:s.id,qty:s.qty,onChange:u=>r.updateQty(u,s)},null,40,ct),t("div",rt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon2",onClick:u=>r.addProduct(s)},_t,8,lt)])])]),t("td",ht,[t("p",ut,c(s.qty*s.product.price),1)]),t("td",bt,[t("i",{class:"bi bi-trash3 text-danger",style:{cursor:"pointer"},onClick:u=>r.delCartItem(s.id)},null,8,mt)]),ft]))),128))])):(n(),a("tbody",gt,[t("p",yt,[y(" 沒有任何商品，去"),f(q,{to:"/products",class:"fw-normal text-decoration-none btn btn-sm bg-dark mx-3 text-white"},{default:k(()=>[y("產品一覽")]),_:1}),y("挑一個吧！ ")])]))]),this.carts.length>=1?(n(),a("div",wt,[S(t("input",{type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"Coupon Code","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":e[1]||(e[1]=s=>i.couponContent=s)},null,512),[[B,i.couponContent]]),t("div",Ct,[t("button",xt,[t("i",{class:"bi bi-ticket-perforated",onClick:e[2]||(e[2]=(...s)=>r.couponTicket&&r.couponTicket(...s))})]),this.noneCoupon?(n(),a("span",kt,c(this.noneCoupon),1)):g("",!0)])])):g("",!0)]),t("div",vt,[t("div",Tt,[Lt,t("table",qt,[t("tbody",null,[t("tr",null,[Pt,!o.startTime||!o.endTime?(n(),a("td",It," 請選擇日期 ")):(n(),a("td",Vt,[t("div",$t,c(o.startTime),1),t("div",Et,c(o.endTime),1)]))]),t("tr",null,[St,o.selectedPeople==="隨便"?(n(),a("td",Bt," 0 ")):(n(),a("td",Nt,c(o.selectedPeople),1))]),t("tr",null,[At,t("td",Rt,"NT$"+c(this.total),1)]),Ut])]),t("div",Dt,[Mt,i.couponStatus?(n(),a("p",jt," NT$"+c(this.final_total),1)):(n(),a("p",Ot,"NT$"+c(this.total),1))]),this.carts.length<=0?(n(),a("button",Ft," 先選購商品吧 ")):(n(),N(P,{key:1,to:"/checkout",class:"text-white text-decoration-none w-100"},{default:k(()=>[Qt]),_:1}))])])])])]),f(I,{active:i.isLoading,"onUpdate:active":e[3]||(e[3]=s=>i.isLoading=s),"can-cancel":!0,"is-full-page":i.fullPage},null,8,["active","is-full-page"])],64)}const Wt=V(U,[["render",zt]]);export{Wt as default};
