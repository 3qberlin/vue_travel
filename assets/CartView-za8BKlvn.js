import{_ as V,m as w,a as C,L as $,r as b,o as n,c as a,d as m,b as t,g,F as x,j as E,e as y,w as k,k as S,v as B,t as c}from"./index-g1-RociA.js";import{S as f,c as v}from"./cartPinia-MG5qE6ON.js";import{a as l}from"./axios-G2rPRu76.js";import{T as N,t as T}from"./TravelConditions-eR1LJyo_.js";var A={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_NAME:"berlin",BASE_URL:"/vue_week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:p,VITE_API_NAME:_}=A,R={computed:{...w(v,["final_total","total","carts"]),...w(T,["selectedPeople","startTime","endTime"])},methods:{...C(v,["getCarts","pinia_carts"]),...C(T,["setPeople"]),addProduct(o){const e={product_id:o.product_id,qty:o.qty+1};this.showLoading(),setTimeout(()=>{const d=`${p}/api/${_}/cart/${o.id}`;l.put(d,{data:e}).then(()=>{this.carts.qty=e.qty,this.getCarts()})},500)},showLoading(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},900)},reduceProduct(o){if(o.qty===1)f.fire({title:"最低數量為1筆",showClass:{popup:`
      animate__animated
      animate__fadeInUp
      animate__faster
    `},hideClass:{popup:`
      animate__animated
      animate__fadeOutDown
      animate__faster
    `}});else{const d={product_id:o.product_id,qty:o.qty-1};this.showLoading();const h=`${p}/api/${_}/cart/${o.id}`;l.put(h,{data:d}).then(()=>{this.carts.qty=d.qty,this.getCarts()})}},delCartItem(o){this.showLoading();const e=`${p}/api/${_}/cart/${o}`;l.delete(e).then(()=>{this.getCarts()}).catch(()=>{})},couponTicket(){const o={code:this.couponContent},e=`${p}/api/${_}/coupon`;this.showLoading(),l.post(e,{data:o}).then(d=>{this.final_total=d.data.data.final_total,this.noneCoupon="已套用優惠券",this.couponStatus=!0,this.getCarts()}).catch(d=>{this.noneCoupon=d.response.data.message,this.final_total=this.total,this.couponStatus=!1,this.getCarts()})},delCarts(){const o=`${p}/api/${_}/carts`;f.fire({title:"刪除確認",text:"確定刪除全部商品？",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確認刪除",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&l.delete(o).then(()=>{this.getCarts(),f.fire({title:"購物車已清空",text:"商品清空",icon:"success"})}).catch(()=>{})})},updateQty(o,e){const d=parseInt(o.target.value,10),h=`${p}/api/${_}/cart/${e.id}`,i={product_id:e.product_id,qty:d};d>=1&&d<=20?l.put(h,{data:i}).then(()=>{this.carts.qty=i.qty,this.getCarts()}):f.fire("請輸入1以上，20以內的數量")}},mounted(){this.getCarts()},data(){return{couponContent:"",noneCoupon:"",countTotal:0,couponStatus:!1,isLoading:!1,fullPage:!0,qty:0}},components:{Loading:$,TravelConditions:N}},U={class:"container"},D={class:"mt-3"},M=t("h3",{class:"mt-3 mb-4"},"購物車",-1),j={class:"row"},O={class:"col-md-8 table-responsive"},F={class:"table table-hover"},Q={key:0},z={class:"text-nowrap"},G=t("th",{scope:"col",class:"border-0 ps-0"},"品項",-1),H=t("th",{scope:"col",class:"border-0"},"數量",-1),J=t("th",{scope:"col",class:"border-0"},"單價",-1),K=t("th",{scope:"col",class:"border-0"},"刪除",-1),W={scope:"col",class:"border-0 text-danger"},X={key:1},Y={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},Z=["src"],tt={class:"mb-0 fw-bold ms-3 d-inline-block"},ot={class:"border-0 align-middle",style:{"max-width":"160px"}},et={class:"input-group pe-5"},st={class:"input-group-prepend"},nt=["onClick"],at=t("i",{class:"bi bi-dash"},null,-1),dt=[at],it=["value","id","qty","onChange"],ct={class:"input-group-append"},rt=["onClick"],lt=t("i",{class:"bi bi-plus-lg"},null,-1),pt=[lt],_t={class:"border-0 align-middle"},ht={class:"mb-0 ms-auto"},ut={class:"border-0 align-middle text-center"},bt=["onClick"],mt=t("td",null,null,-1),ft={key:2},gt={class:"fs-5 text-center"},yt={key:0,class:"input-group w-50 mb-3"},wt={class:"input-group-append"},Ct={class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2"},xt={key:0},kt={class:"col-md-4"},vt={class:"border p-4 mb-4"},Tt=t("h4",{class:"fw-bold mb-4"},"訂單資料",-1),Lt={class:"table text-muted border-bottom"},qt=t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal d-flex flex-grow-1"}," 旅遊期間 ",-1),Pt={key:0,class:"text-end border-0 px-0 pt-4"},It={key:1,class:"text-end border-0 px-0 pt-3 d-flex flex-wrap w-100"},Vt={class:"w-100"},$t={class:"w-100"},Et=t("th",{scope:"row",class:"border-0 px-0 pt-3 font-weight-normal"}," 人數 ",-1),St={key:0,class:"text-end border-0 px-0 pt-4"},Bt={key:1,class:"text-end border-0 px-0 pt-3"},Nt=t("th",{scope:"row",class:"border-0 px-0 font-weight-normal"}," 小計 ",-1),At={class:"text-end border-0 px-0"},Rt=t("tr",null,[t("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 pt-2 font-weight-normal"}," 付款方式 "),t("td",{class:"text-end border-0 px-0 pt-0 pb-4 pt-2"},"LinePay")],-1),Ut={class:"d-flex justify-content-between mt-4"},Dt=t("p",{class:"mb-0 h4 fw-bold"},"總計",-1),Mt={key:0,class:"mb-0 h4 fw-bold"},jt={key:1,class:"mb-0 h4 fw-bold"},Ot={key:0,class:"btn btn-dark w-100 mt-4",disabled:"",tabindex:"-1"},Ft={key:1,class:"btn btn-dark w-100 mt-4"};function Qt(o,e,d,h,i,r){const L=b("TravelConditions"),q=b("router-link"),P=b("RouterLink"),I=b("loading");return n(),a(x,null,[m(L),t("div",U,[t("div",D,[M,t("div",j,[t("div",O,[t("table",F,[this.carts.length>=1?(n(),a("thead",Q,[t("tr",z,[G,H,J,K,t("th",W,[t("div",{class:"badge bg-danger fw-normal",onClick:e[0]||(e[0]=(...s)=>r.delCarts&&r.delCarts(...s)),style:{cursor:"pointer"}}," 全刪 ")])])])):g("",!0),this.carts.length>=1?(n(),a("tbody",X,[(n(!0),a(x,null,E(o.carts,s=>(n(),a("tr",{class:"border-bottom border-top",key:s},[t("th",Y,[t("img",{src:s.product.imagesUrl,alt:"images",style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,Z),t("p",tt,c(s.product.title),1)]),t("td",ot,[t("div",et,[t("div",st,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon1",onClick:u=>r.reduceProduct(s)},dt,8,nt)]),t("input",{type:"text",class:"form-control border-0 text-center my-auto shadow-none",placeholder:"","aria-label":"Example text with button addon","aria-describedby":"button-addon1",value:s.qty,id:s.id,qty:s.qty,onChange:u=>r.updateQty(u,s)},null,40,it),t("div",ct,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon2",onClick:u=>r.addProduct(s)},pt,8,rt)])])]),t("td",_t,[t("p",ht,c(s.qty*s.product.price),1)]),t("td",ut,[t("i",{class:"bi bi-trash3 text-danger",style:{cursor:"pointer"},onClick:u=>r.delCartItem(s.id)},null,8,bt)]),mt]))),128))])):(n(),a("tbody",ft,[t("p",gt,[y(" 沒有任何商品，去"),m(q,{to:"/products",class:"fw-normal text-decoration-none btn btn-sm bg-dark mx-3 text-white"},{default:k(()=>[y("產品一覽")]),_:1}),y("挑一個吧！ ")])]))]),this.carts.length>=1?(n(),a("div",yt,[S(t("input",{type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"Coupon Code","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":e[1]||(e[1]=s=>i.couponContent=s)},null,512),[[B,i.couponContent]]),t("div",wt,[t("button",Ct,[t("i",{class:"bi bi-ticket-perforated",onClick:e[2]||(e[2]=(...s)=>r.couponTicket&&r.couponTicket(...s))})]),this.noneCoupon?(n(),a("span",xt,c(this.noneCoupon),1)):g("",!0)])])):g("",!0)]),t("div",kt,[t("div",vt,[Tt,t("table",Lt,[t("tbody",null,[t("tr",null,[qt,!o.startTime||!o.endTime?(n(),a("td",Pt,"請選擇日期 ")):(n(),a("td",It,[t("div",Vt,c(o.startTime),1),t("div",$t,c(o.endTime),1)]))]),t("tr",null,[Et,o.selectedPeople==="隨便"?(n(),a("td",St," 0 ")):(n(),a("td",Bt,c(o.selectedPeople),1))]),t("tr",null,[Nt,t("td",At," NT$"+c(this.total),1)]),Rt])]),t("div",Ut,[Dt,i.couponStatus?(n(),a("p",Mt," NT$"+c(this.final_total),1)):(n(),a("p",jt,"NT$"+c(this.total),1))]),m(P,{to:"/checkout"},{default:k(()=>[this.carts.length<=0?(n(),a("button",Ot," 先選購商品吧 ")):(n(),a("button",Ft,"送出訂單"))]),_:1})])])])])]),m(I,{active:i.isLoading,"onUpdate:active":e[3]||(e[3]=s=>i.isLoading=s),"can-cancel":!0,"is-full-page":i.fullPage},null,8,["active","is-full-page"])],64)}const Kt=V(R,[["render",Qt]]);export{Kt as default};
